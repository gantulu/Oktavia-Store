
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iStore Premium - Apple Authorized</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fbfbfb; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .active-tab { color: black; transform: scale(1.1); font-weight: bold; }
        .drawer-up { transform: translateY(0); }
        .drawer-down { transform: translateY(100%); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body class="bg-gray-100 flex justify-center">

    <!-- Main Container (Mobile Frame) -->
    <div id="app" class="w-full max-w-md bg-white min-h-screen relative shadow-2xl flex flex-col overflow-x-hidden">
        
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-100 px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
                    <i class="fab fa-apple text-white text-xl"></i>
                </div>
                <h1 class="text-lg font-bold tracking-tight text-gray-900">iStore</h1>
            </div>
            <div class="flex items-center gap-4">
                <button class="relative p-2 text-gray-600">
                    <i class="fas fa-shopping-cart text-lg"></i>
                    <span id="cart-count" class="absolute top-1 right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
                </button>
                <button class="p-2 text-gray-600"><i class="fas fa-search text-lg"></i></button>
            </div>
        </header>

        <!-- Dynamic Content Area -->
        <main id="main-content" class="flex-1 pb-24 overflow-y-auto">
            <!-- Content will be injected here by JS -->
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 w-full max-w-md bg-white/90 backdrop-blur-xl border-t border-gray-100 px-8 py-3 pb-6 z-40 flex justify-between items-center">
            <button onclick="switchTab('home')" id="tab-home" class="flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px] uppercase font-bold tracking-tighter">Home</span>
            </button>
            <button onclick="switchTab('catalog')" id="tab-catalog" class="flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-th-large text-xl"></i>
                <span class="text-[10px] uppercase font-bold tracking-tighter">Catalog</span>
            </button>
            <button onclick="switchTab('profile')" id="tab-profile" class="flex flex-col items-center gap-1 text-gray-400">
                <i class="fas fa-user text-xl"></i>
                <span class="text-[10px] uppercase font-bold tracking-tighter">Profile</span>
            </button>
        </nav>

        <!-- Fullscreen Product Drawer -->
        <div id="product-drawer" class="fixed inset-0 z-[100] hidden">
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDrawer()"></div>
            <div id="drawer-content" class="absolute inset-x-0 bottom-0 top-0 bg-white rounded-t-3xl shadow-2xl transition-transform duration-300 drawer-down overflow-y-auto">
                <!-- Product details injected here -->
            </div>
        </div>

    </div>

    <script>
        // --- DATA & CONFIG ---
        const API_BANNERS = "https://opensheet.elk.sh/1pztiIdabsxJ_NyIuaHFFio0ppS1pTP9Fy8Hnxi5Rjws/Sheet1";
        const API_PRODUCTS = "https://opensheet.elk.sh/1x2Rtyeyq3WR6yFybA8stGP0mdI2dlKvBz6fhx7FIjhQ/Sheet1";
        
        let state = {
            activeTab: 'home',
            banners: [],
            bannerIndex: 0,
            allProducts: [],
            currentUser: JSON.parse(localStorage.getItem('istore_user')) || null,
            cart: [],
            activeCategory: 'All'
        };

        const quickActions = [
            { title: "iPhone", icon: "fa-mobile-alt" },
            { title: "iWatch", icon: "fa-stopwatch" },
            { title: "iMac", icon: "fa-desktop" },
            { title: "iPad", icon: "fa-tablet-alt" },
            { title: "AirPods", icon: "fa-headphones" }
        ];

        // --- CORE FUNCTIONS ---

        async function init() {
            renderApp();
            fetchBanners();
            fetchProducts();
            startBannerTimer();
        }

        async function fetchBanners() {
            try {
                const res = await fetch(API_BANNERS);
                state.banners = await res.json();
                if(state.activeTab === 'home') renderHome();
            } catch (e) { console.error("Banner fetch error", e); }
        }

        async function fetchProducts() {
            try {
                const res = await fetch(API_PRODUCTS);
                state.allProducts = await res.json();
                if(state.activeTab === 'home') renderHome();
                if(state.activeTab === 'catalog') renderCatalog();
            } catch (e) { console.error("Product fetch error", e); }
        }

        function switchTab(tab) {
            state.activeTab = tab;
            renderApp();
        }

        function renderApp() {
            // Update Tab styles
            ['home', 'catalog', 'profile'].forEach(t => {
                const el = document.getElementById(`tab-${t}`);
                if (t === state.activeTab) el.classList.add('active-tab');
                else el.classList.remove('active-tab');
            });

            if (state.activeTab === 'home') renderHome();
            else if (state.activeTab === 'catalog') renderCatalog();
            else if (state.activeTab === 'profile') renderProfile();
        }

        // --- RENDERERS ---

        function renderHome() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <!-- Banner Section -->
                <div id="banner-container" class="px-4 mt-4 relative overflow-hidden h-44">
                    ${renderBanners()}
                </div>

                <!-- Quick Action -->
                <div class="grid grid-cols-5 gap-2 px-4 mt-8">
                    ${quickActions.map(a => `
                        <div class="flex flex-col items-center gap-2 group cursor-pointer">
                            <div class="w-12 h-12 rounded-2xl bg-white shadow-sm border border-gray-100 flex items-center justify-center text-gray-700">
                                <i class="fas ${a.icon} text-lg"></i>
                            </div>
                            <span class="text-[9px] font-bold text-gray-500 uppercase tracking-tighter">${a.title}</span>
                        </div>
                    `).join('')}
                </div>

                <!-- Flash Sale -->
                <div class="mt-10">
                    <div class="px-4 flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <h2 class="text-lg font-bold text-gray-900">Flash Sale</h2>
                            <div class="bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded">02 : 45 : 12</div>
                        </div>
                        <button class="text-blue-600 text-xs font-bold">Lihat Semua</button>
                    </div>
                    <div class="flex gap-4 overflow-x-auto px-4 pb-4 hide-scrollbar">
                        ${renderFlashSale()}
                    </div>
                </div>

                <!-- Popular Products -->
                <div class="mt-8 px-4 pb-10">
                    <h2 class="text-lg font-bold text-gray-900 mb-4">Popular Produk</h2>
                    <div class="grid grid-cols-2 gap-4">
                        ${renderGridProducts(state.allProducts.slice(0, 8))}
                    </div>
                </div>
            `;
        }

        function renderBanners() {
            if (state.banners.length === 0) return `<div class="w-full h-full bg-gray-100 animate-pulse rounded-2xl"></div>`;
            return state.banners.map((b, i) => `
                <div class="banner-slide absolute inset-x-0 top-0 h-full transition-all duration-700 px-4 transform ${i === state.bannerIndex ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}" 
                     style="left: 0;">
                    <div class="w-full h-full rounded-2xl p-6 flex flex-col justify-between" style="background-color: ${b.backgroundColor}; color: ${b.textColor}">
                        <div class="flex justify-between items-start">
                            <div class="max-w-[70%]">
                                <h3 class="text-lg font-bold line-clamp-1">${b.title}</h3>
                                <p class="text-[10px] opacity-80 mt-1">${b.subtitle}</p>
                            </div>
                            <div class="w-10 h-10 opacity-30">${b.icon}</div>
                        </div>
                        ${b.tombol_ambil === 'TRUE' ? `
                            <div class="flex items-center justify-between">
                                <span class="text-[10px] font-mono font-bold bg-white/20 px-2 py-1 rounded">${b.kode_voucher}</span>
                                <button class="bg-black text-white text-[9px] font-bold px-4 py-2 rounded-full uppercase">Ambil Voucher</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderFlashSale() {
            const fs = state.allProducts.filter(p => p.event_tag === 'flashsale').slice(0, 5);
            if(fs.length === 0) return Array(3).fill(`<div class="w-32 h-44 bg-gray-100 rounded-xl animate-pulse"></div>`).join('');
            return fs.map(p => `
                <div onclick="openProduct('${p.item_group_id}')" class="flex-shrink-0 w-32 bg-white rounded-xl border border-gray-100 overflow-hidden shadow-sm active:scale-95 transition">
                    <div class="bg-gray-50 aspect-square p-4">
                        <img src="${p.image_link}" class="w-full h-full object-contain">
                    </div>
                    <div class="p-2">
                        <p class="text-[10px] font-bold line-clamp-1">${p.title}</p>
                        <p class="text-red-500 font-bold text-xs">${formatIDR(p.sale_price || p.price)}</p>
                        <div class="mt-2 h-1 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-red-500 w-[70%]"></div>
                        </div>
                        <p class="text-[8px] text-gray-400 mt-1 uppercase font-bold">Segera Habis</p>
                    </div>
                </div>
            `).join('');
        }

        function renderGridProducts(items) {
            if(items.length === 0) return '';
            return items.map(p => `
                <div onclick="openProduct('${p.item_group_id}')" class="bg-white rounded-2xl border border-gray-100 overflow-hidden flex flex-col active:scale-[0.98] transition">
                    <div class="bg-gray-50 aspect-square p-6 relative">
                        <img src="${p.image_link}" class="w-full h-full object-contain">
                        ${p.discount_percentage > 0 ? `<span class="absolute top-2 left-2 bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full">-${p.discount_percentage}%</span>` : ''}
                    </div>
                    <div class="p-3 flex-1 flex flex-col">
                        <p class="text-[11px] font-medium text-gray-800 line-clamp-2 mb-2 flex-1">${p.title}</p>
                        <p class="font-bold text-sm text-black">${formatIDR(p.sale_price || p.price)}</p>
                        <div class="flex items-center gap-1 mt-2">
                            <i class="fas fa-star text-yellow-400 text-[10px]"></i>
                            <span class="text-[10px] text-gray-400 font-bold">${(p.rating/100).toFixed(1)} | Terjual ${p.sold}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderCatalog() {
            const categories = ['All', ...new Set(state.allProducts.map(p => p.category_name).filter(Boolean))];
            const filtered = state.activeCategory === 'All' ? state.allProducts : state.allProducts.filter(p => p.category_name === state.activeCategory);
            
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <div class="p-4 bg-white sticky top-0 z-30 border-b border-gray-100">
                    <h2 class="text-xl font-bold mb-4">Catalog Produk</h2>
                    <div class="flex gap-2 overflow-x-auto hide-scrollbar">
                        ${categories.map(c => `
                            <button onclick="setCategory('${c}')" class="px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ${state.activeCategory === c ? 'bg-black text-white' : 'bg-gray-100 text-gray-500'}">
                                ${c}
                            </button>
                        `).join('')}
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 p-4">
                    ${renderGridProducts(filtered)}
                </div>
            `;
        }

        function renderProfile() {
            const main = document.getElementById('main-content');
            if (!state.currentUser) {
                main.innerHTML = renderAuth();
            } else {
                main.innerHTML = `
                    <div class="p-6 bg-white border-b border-gray-100">
                        <div class="flex items-center gap-4">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${state.currentUser.phone}" class="w-16 h-16 rounded-full bg-blue-50 border-2 border-white shadow-md">
                            <div>
                                <h2 class="text-lg font-bold">${state.currentUser.name || 'User'}</h2>
                                <p class="text-xs text-gray-500">${state.currentUser.phone}</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 space-y-4">
                        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex justify-between">
                            ${['Belum Bayar', 'Dikemas', 'Dikirim', 'Beri Nilai'].map((l, i) => `
                                <div class="flex flex-col items-center gap-1">
                                    <div class="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center text-gray-400">
                                        <i class="fas ${['fa-wallet', 'fa-box', 'fa-truck', 'fa-star'][i]}"></i>
                                    </div>
                                    <span class="text-[8px] font-bold text-gray-400 uppercase">${l}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-white rounded-2xl overflow-hidden border border-gray-100">
                            <div class="p-4 flex items-center gap-4 border-b border-gray-50">
                                <i class="fas fa-heart text-blue-500"></i>
                                <span class="text-sm font-medium">Wishlist Saya</span>
                                <i class="fas fa-chevron-right ml-auto text-gray-300 text-xs"></i>
                            </div>
                            <div class="p-4 flex items-center gap-4 border-b border-gray-50">
                                <i class="fas fa-ticket-alt text-orange-500"></i>
                                <span class="text-sm font-medium">Voucher Saya</span>
                                <i class="fas fa-chevron-right ml-auto text-gray-300 text-xs"></i>
                            </div>
                        </div>
                        <button onclick="handleLogout()" class="w-full py-4 bg-white text-red-500 font-bold rounded-2xl border border-gray-100">Keluar Sesi</button>
                    </div>
                `;
            }
        }

        function renderAuth(isRegister = false) {
            return `
                <div class="min-h-[70vh] flex flex-col items-center justify-center p-8">
                    <div class="w-16 h-16 bg-black rounded-2xl flex items-center justify-center mb-6 shadow-xl">
                        <i class="fab fa-apple text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">${isRegister ? 'Daftar Akun' : 'Selamat Datang'}</h2>
                    <p class="text-gray-400 text-xs text-center mb-8">Lengkapi data untuk pengalaman belanja terbaik</p>
                    
                    <div id="auth-error" class="hidden w-full p-3 bg-red-50 text-red-500 text-[10px] font-bold rounded-lg mb-4 text-center"></div>

                    <form onsubmit="handleAuth(event, ${isRegister})" class="w-full space-y-3">
                        ${isRegister ? `<input type="text" id="auth-name" placeholder="Nama Lengkap" class="w-full p-4 bg-gray-50 rounded-xl text-sm focus:ring-2 focus:ring-black outline-none" required>` : ''}
                        <input type="tel" id="auth-phone" placeholder="Nomor Telepon" class="w-full p-4 bg-gray-50 rounded-xl text-sm focus:ring-2 focus:ring-black outline-none" required>
                        <input type="password" id="auth-pass" placeholder="Password" class="w-full p-4 bg-gray-50 rounded-xl text-sm focus:ring-2 focus:ring-black outline-none" required>
                        <button class="w-full py-4 bg-black text-white font-bold rounded-xl shadow-lg mt-4 active:scale-95 transition">
                            ${isRegister ? 'Daftar Sekarang' : 'Masuk'}
                        </button>
                    </form>
                    <button onclick="toggleAuth(${!isRegister})" class="mt-6 text-sm text-gray-500">
                        ${isRegister ? 'Sudah punya akun? <span class="text-black font-bold">Masuk</span>' : 'Belum punya akun? <span class="text-black font-bold">Daftar</span>'}
                    </button>
                </div>
            `;
        }

        // --- HANDLERS ---

        function setCategory(cat) {
            state.activeCategory = cat;
            renderCatalog();
        }

        function toggleAuth(isRegister) {
            const main = document.getElementById('main-content');
            main.innerHTML = renderAuth(isRegister);
        }

        function handleAuth(e, isRegister) {
            e.preventDefault();
            const phone = document.getElementById('auth-phone').value;
            const pass = document.getElementById('auth-pass').value;
            const errorEl = document.getElementById('auth-error');

            const users = JSON.parse(localStorage.getItem('istore_users') || '[]');

            if (isRegister) {
                const name = document.getElementById('auth-name').value;
                if (users.find(u => u.phone === phone)) {
                    errorEl.innerText = "Nomor telepon sudah terdaftar";
                    errorEl.classList.remove('hidden');
                    return;
                }
                const newUser = { name, phone, pass };
                users.push(newUser);
                localStorage.setItem('istore_users', JSON.stringify(users));
                state.currentUser = newUser;
                localStorage.setItem('istore_user', JSON.stringify(newUser));
                renderApp();
            } else {
                const user = users.find(u => u.phone === phone && u.pass === pass);
                if (user) {
                    state.currentUser = user;
                    localStorage.setItem('istore_user', JSON.stringify(user));
                    renderApp();
                } else {
                    errorEl.innerText = "Nomor ponsel atau password yang anda masukkan salah";
                    errorEl.classList.remove('hidden');
                }
            }
        }

        function handleLogout() {
            localStorage.removeItem('istore_user');
            state.currentUser = null;
            renderApp();
        }

        function startBannerTimer() {
            setInterval(() => {
                if(state.activeTab === 'home' && state.banners.length > 0) {
                    state.bannerIndex = (state.bannerIndex + 1) % state.banners.length;
                    const container = document.getElementById('banner-container');
                    if(container) container.innerHTML = renderBanners();
                }
            }, 4000);
        }

        function openProduct(groupId) {
            const group = state.allProducts.filter(p => p.item_group_id === groupId);
            const product = group[0];
            const drawer = document.getElementById('product-drawer');
            const content = document.getElementById('drawer-content');
            
            const uniqueColors = [...new Set(group.map(p => p.title.split(' - ')[1]?.split(',')[0]))].filter(Boolean);
            const uniqueStorage = [...new Set(group.map(p => p.title.split(', ')[1]))].filter(Boolean);

            content.innerHTML = `
                <div class="p-4 flex items-center justify-between sticky top-0 bg-white/80 backdrop-blur-md z-10">
                    <button onclick="closeDrawer()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center"><i class="fas fa-chevron-down"></i></button>
                    <span class="text-xs font-bold uppercase tracking-widest">Detail Produk</span>
                    <button class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center"><i class="fas fa-share-alt"></i></button>
                </div>
                <div class="px-6 pb-32">
                    <div class="bg-gray-50 rounded-3xl aspect-square p-10 flex items-center justify-center mb-6">
                        <img src="${product.image_link}" class="w-full h-full object-contain">
                    </div>
                    <h2 class="text-2xl font-bold mb-2">${product.title}</h2>
                    <div class="flex items-center gap-2 mb-6">
                        <span class="bg-blue-50 text-blue-600 text-[10px] font-bold px-2 py-1 rounded">OFFICIAL STORE</span>
                        <div class="text-yellow-400 text-xs font-bold"><i class="fas fa-star mr-1"></i>${(product.rating/100).toFixed(1)}</div>
                    </div>
                    
                    <div class="p-4 bg-gray-50 rounded-2xl mb-8">
                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Harga Special</p>
                        <p class="text-2xl font-black">${formatIDR(product.sale_price || product.price)}</p>
                    </div>

                    ${uniqueColors.length > 0 ? `
                        <div class="mb-6">
                            <p class="text-xs font-bold uppercase text-gray-400 mb-3">Pilih Warna</p>
                            <div class="flex gap-2">
                                ${uniqueColors.map(c => `<button class="px-4 py-2 border-2 border-black rounded-xl text-[10px] font-bold">${c}</button>`).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="mb-6">
                        <p class="text-xs font-bold uppercase text-gray-400 mb-3">Deskripsi</p>
                        <p class="text-xs text-gray-500 leading-relaxed">Nikmati teknologi tercanggih dari Apple. Produk orisinal dengan garansi resmi. Performa luar biasa untuk kebutuhan harian dan profesional.</p>
                    </div>
                </div>
                <div class="fixed bottom-0 inset-x-0 p-4 bg-white/80 backdrop-blur-md border-t border-gray-100 flex gap-3 z-50">
                    <button class="w-14 h-14 rounded-2xl border-2 border-gray-100 flex items-center justify-center"><i class="far fa-heart text-xl"></i></button>
                    <button onclick="addToCart()" class="flex-1 h-14 bg-black text-white rounded-2xl font-bold active:scale-95 transition">+ Keranjang</button>
                </div>
            `;
            
            drawer.classList.remove('hidden');
            setTimeout(() => content.classList.replace('drawer-down', 'drawer-up'), 10);
            document.body.style.overflow = 'hidden';
        }

        function closeDrawer() {
            const content = document.getElementById('drawer-content');
            content.classList.replace('drawer-up', 'drawer-down');
            setTimeout(() => {
                document.getElementById('product-drawer').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        }

        function formatIDR(val) {
            const n = parseInt(val.replace(/\D/g, ''));
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
        }

        function addToCart() {
            state.cart.push({});
            document.getElementById('cart-count').innerText = state.cart.length;
            closeDrawer();
        }

        // Run app
        init();
    </script>
</body>
</html>
